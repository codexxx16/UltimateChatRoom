<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatRoom Pro - AI Enhanced</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
:root {--primary:#6e8efb;--secondary:#a777e3;--dark:#2c3e50;--light:#f5f7ff;--success:#2ecc71;--danger:#e74c3c;--info:#3498db;--gray:#95a5a6;--white:#ffffff;}
body{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#333;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:10px;}
.container{width:100%;max-width:1000px;background:rgba(255,255,255,0.97);border-radius:15px;overflow:hidden;box-shadow:0 15px 30px rgba(0,0,0,0.2);display:flex;flex-direction:column;height:90vh;position:relative;}
#login-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;height:100%;}
.login-header{text-align:center;margin-bottom:30px;}
.logo{font-size:36px;font-weight:700;color:var(--primary);margin-bottom:10px;display:flex;align-items:center;justify-content:center;}
.logo i{margin-right:10px;}
.tagline{color:var(--dark);font-size:18px;}
.login-form{width:100%;max-width:400px;background:var(--light);padding:30px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
.form-group{margin-bottom:20px;}
label{display:block;margin-bottom:8px;font-weight:600;color:var(--dark);}
input{width:100%;padding:14px;border:2px solid #ddd;border-radius:8px;font-size:16px;outline:none;transition:border 0.3s;}
input:focus{border-color:var(--primary);}
.btn{padding:14px;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:all 0.3s;display:flex;align-items:center;justify-content:center;width:100%;font-size:16px;}
.btn i{margin-right:8px;}
.btn-primary{background:var(--primary);color:white;}
.btn-primary:hover{background:#5a7ce2;}
.btn-danger{background:var(--danger);color:white;}
.btn-danger:hover{background:#c0392b;}
#app-screen{display:none;flex-direction:column;height:100%;}
header{background:var(--primary);color:white;padding:20px;text-align:center;position:relative;display:flex;justify-content:space-between;align-items:center;}
.header-controls{display:flex;align-items:center;}
.online-count{background:rgba(255,255,255,0.2);padding:8px 15px;border-radius:20px;font-size:14px;margin-right:15px;display:flex;align-items:center;}
.online-count i{margin-right:5px;}
.main-content{display:flex;flex:1;overflow:hidden;flex-direction:column;}
.nav-tabs{display:flex;background:var(--light);border-bottom:1px solid #e0e5ff;}
.nav-tab{padding:15px 20px;cursor:pointer;font-weight:600;color:var(--dark);border-bottom:3px solid transparent;transition:all 0.3s;flex:1;text-align:center;}
.nav-tab.active{border-bottom:3px solid var(--primary);color:var(--primary);}
.nav-tab i{margin-right:8px;}
.screen{display:none;flex:1;padding:20px;overflow-y:auto;flex-direction:column;}
.active-screen{display:flex;}
.chat-messages{flex:1;padding:20px;overflow-y:auto;background:white;border-radius:10px;}
.message{margin-bottom:15px;display:flex;flex-direction:column;}
.message-header{display:flex;margin-bottom:5px;}
.sender{font-weight:600;color:var(--primary);}
.ai-sender{font-weight:600;color:var(--secondary);}
.timestamp{font-size:12px;color:var(--gray);margin-left:10px;}
.message-content{background:#f0f4ff;padding:10px 15px;border-radius:8px;max-width:80%;align-self:flex-start;}
.my-message .message-content{background:var(--primary);color:white;align-self:flex-end;}
.ai-message .message-content{background:var(--secondary);color:white;}
.chat-input{padding:15px;background:var(--light);display:flex;border-top:1px solid #e0e5ff;}
.chat-input input{flex:1;margin-right:10px;padding:12px;border-radius:8px;border:1px solid #ddd;font-size:16px;}
.chat-input button{padding:12px 20px;border-radius:8px;border:none;background:var(--primary);color:white;font-weight:600;cursor:pointer;transition:0.3s;}
.chat-input button:hover{background:#5a7ce2;}
.notification{padding:10px;margin:10px 0;background:#e7f5ff;border-radius:8px;text-align:center;font-size:14px;color:var(--info);}
.error{padding:10px;margin:10px 0;background:#ffe7e7;border-radius:8px;text-align:center;font-size:14px;color:var(--danger);}
.loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s ease-in-out infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
</style>
</head>
<body>
<div class="container">
  <!-- Login Screen -->
  <div id="login-screen">
    <div class="login-header">
      <div class="logo"><i class="fas fa-comments"></i> ChatRoom Pro</div>
      <div class="tagline">Connect and chat with AI and other users</div>
    </div>
    <div class="login-form">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Enter your email">
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter your password">
      </div>
      <button class="btn btn-primary" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login / Sign Up</button>
      <div id="login-msg"></div>
    </div>
  </div>

  <!-- App Screen -->
  <div id="app-screen">
    <header>
      <div>ChatRoom Pro</div>
      <div class="header-controls">
        <div class="online-count"><i class="fas fa-users"></i> <span id="onlineUsers">0</span></div>
        <button class="btn btn-danger" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </header>
    <div class="main-content">
      <div class="screen active-screen" id="chatScreen">
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
          <input type="text" id="messageInput" placeholder="Type a message...">
          <button id="sendBtn"><i class="fas fa-paper-plane"></i> Send</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Firebase & JS -->
<script type="module">
// Import what you need from Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
import { getDatabase, ref, push, set, onChildAdded, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

// Your config
const firebaseConfig = {
  apiKey: "AIzaSyDXlJMf21zKgyBK1_0w38A2ne__cAbyxPU",
  authDomain: "chatroomai-333ed.firebaseapp.com",
  projectId: "chatroomai-333ed",
  storageBucket: "chatroomai-333ed.firebasestorage.app",
  messagingSenderId: "409648887637",
  appId: "1:409648887637:web:8f2af3540d65c79264e1dc",
  measurementId: "G-BV4JE727E3"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

// Initialize Auth
const auth = getAuth(app);
const db = getDatabase(app);

// DOM Elements
const loginScreen = document.getElementById("login-screen");
const appScreen = document.getElementById("app-screen");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const loginMsg = document.getElementById("login-msg");
const chatMessages = document.getElementById("chatMessages");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const onlineUsers = document.getElementById("onlineUsers");

// Gemini AI API Key
const GEMINI_KEY = "AIzaSyAXd4GeRen6mBCQViRzxjFOsOkoFq_wN78";

// Login
loginBtn.addEventListener("click", async ()=>{
  const email=emailInput.value.trim();
  const password=passwordInput.value.trim();
  loginMsg.textContent="";
  if(!email||!password){loginMsg.textContent="Please fill both fields."; return;}
  try{
    await signInWithEmailAndPassword(auth,email,password);
  }catch(err){
    if(err.code==="auth/user-not-found"){
      try{
        await createUserWithEmailAndPassword(auth,email,password);
      }catch(e){loginMsg.textContent=e.message;}
    }else{loginMsg.textContent=err.message;}
  }
});

// Logout
logoutBtn.addEventListener("click",()=>signOut(auth));

// Auth state
let currentUser=null;
onAuthStateChanged(auth,user=>{
  if(user){
    currentUser=user;
    loginScreen.style.display="none";
    appScreen.style.display="flex";
    setupChat();
  }else{
    loginScreen.style.display="flex";
    appScreen.style.display="none";
    chatMessages.innerHTML="";
  }
});

// Chat
function setupChat(){
  const userRef=ref(db,"users/"+currentUser.uid);
  set(userRef,{email:currentUser.email,online:true});
  onValue(ref(db,"users"),snap=>{
    const data=snap.val(); let count=0;
    for(let k in data){if(data[k].online)count++;}
    onlineUsers.textContent=count;
  });

  const messagesRef=ref(db,"messages");
  onChildAdded(messagesRef,snap=>{
    const msg=snap.val();
    const div=document.createElement("div");
    div.classList.add("message");
    if(msg.sender===currentUser.email){div.classList.add("my-message");}
    else if(msg.sender==="AI"){div.classList.add("ai-message");}
    const header=document.createElement("div");header.classList.add("message-header");
    const sender=document.createElement("span");sender.textContent=msg.sender;
    sender.className=msg.sender==="AI"?"ai-sender":"sender";
    const time=document.createElement("span");time.classList.add("timestamp");
    const d=new Date(msg.timestamp);time.textContent=d.toLocaleTimeString();
    header.appendChild(sender);header.appendChild(time);
    const content=document.createElement("div");content.classList.add("message-content");content.textContent=msg.text;
    div.appendChild(header);div.appendChild(content);chatMessages.appendChild(div);
    chatMessages.scrollTop=chatMessages.scrollHeight;
  });

  sendBtn.addEventListener("click",sendMessage);
  messageInput.addEventListener("keypress",e=>{if(e.key==="Enter")sendMessage();});
}

async function sendMessage(){
  const text=messageInput.value.trim();
  if(!text)return;
  const msgRef=push(ref(db,"messages"));
  await set(msgRef,{sender:currentUser.email,text,timestamp:Date.now()});
  messageInput.value="";
  sendToAI(text);
}

// Send message to Gemini AI
async function sendToAI(userText){
  const url="https://api.generativeai.googleapis.com/v1beta2/models/text-bison-001:generateText";
  try{
    const resp=await fetch(url,{
      method:"POST",
      headers:{"Content-Type":"application/json","Authorization":"Bearer "+GEMINI_KEY},
      body:JSON.stringify({prompt:{text:userText},temperature:0.7,maxOutputTokens:200})
    });
    const data=await resp.json();
    const aiText=data?.candidates?.[0]?.content||"Sorry, I couldn't respond.";
    const msgRef=push(ref(db,"messages"));
    await set(msgRef,{sender:"AI",text:aiText,timestamp:Date.now()});
  }catch(err){
    console.error(err);
  }
}
</script>
</body>
                                                        </html>
